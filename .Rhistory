grid <- read.table('data_output/rus_grid_reg2.csv', header=TRUE, sep=',') %>%
mutate(code = ifelse(nchar(code)==10, paste0('0', code), code)) %>%
mutate(code_FD = ifelse(nchar(code_FD)==2, paste0('0', code_FD), code_FD))
df <- data$df_FD %>% mutate(value = ifelse(value==0, NA, value))
if (dynam) {
data_date <- df %>% group_by(OKATO_id) %>% mutate(value = (value/lag(value, 12) - 1)*100 ) %>%
filter(date == date_choice) %>%
right_join(grid, by=c("OKATO_id" = "code_FD")) %>% select(-row, -col)
} else {
data_date <- df %>%
filter(date == date_choice) %>%
right_join(grid, by=c("OKATO_id" = "code_FD"))
}
grid <- grid %>% select(-code_FD) %>% rename("name" = "FD")
}
p <- data_date %>% ggplot() +
geom_rect(mapping=aes(xmin=1, xmax=2, ymin=1, ymax=2, fill=value, text=""),
color=NA, alpha=1) +
facet_geo(~ code, grid = grid) +
labs(x='', y='') +
theme_minimal() +
theme(axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x=element_blank(),
axis.title.y=element_blank(),
axis.text.y=element_blank(),
axis.ticks.y=element_blank(),
strip.placement = "bottom",
plot.title = element_text(hjust = 5),
strip.background = element_blank(),
strip.text.x = element_blank(),
line = element_blank(),
plot.margin = margin(-2, "points"),
panel.spacing = unit(-2, "points")
)
if (dynam) {
p <- p + scale_fill_gradientn(name='Темпы роста, % г/г',
colours=c("#e83131", "#ffbfbf", "white", "#c3ffbf","#3AE831"),
na.value="#D0D0D0",
oob=oob_squish,
# trans="pseudo_log",
values=rescale(c(-10,-0.00000001,0,0.000000001,10)),
n.breaks=4,
minor_breaks = NULL,
limits=c(-10,10))
# p <- p + scale_fill_manual(name='Темпы роста производства, %',
#                               values=c("1" = "#FF0000", "2" = "#e83131", "3" = "#ffbfbf", "4" = "#c3ffbf", "5" = "#3AE831", "6" = "#0dff00"),
#                               na.value="#D0D0D0")
# p <- p + binned_scale("fill",
#                           "foo",
#                           ggplot2:::binned_pal(scales::manual_pal(c("#FF0000","#e83131","#ffbfbf","#c3ffbf", "#3AE831", "#0dff00"))),
#                           guide="coloursteps",
#                           breaks=c(-10,-5,0,5,10),
#                           limits=c(-10, 10),
#                           oob=oob_squish,
#                           na.value="#D0D0D0",
#                       show.limits = TRUE,
#)
} else {
p <- p + scale_fill_gradient(name=paste('Производство, ', ed, sep=''), na.value="#D0D0D0", high="#85D6FF", low = "#0078D4")
}
if (!level_fed) {
p <- p + geom_text(aes(x = 1.5, y = 1.5, label = name,
text=paste0(name_long, ', ', as.yearmon(date_choice), ': ', ifelse(is.na(value),
'нет данных',
paste0(round(value, 1), ifelse(dynam,
'%',
paste0(' ', ed))
)
)
)
), col="white", size=4)
} else {
p <- p + geom_text(aes(x = 1.5, y = 1.5, label = paste0(name_short, '\n', FD),
text=paste0(FD, ', ', as.yearmon(date_choice), ': ', ifelse(is.na(value),
'нет данных',
paste0(round(value, 1), ifelse(dynam,
'%',
paste0(' ', ed))
)
)
)
), col="white", size=4)
}
p <- ggplotly(p + theme(legend.position="bottom"), height=600, tooltip='text') %>%
config(doubleClick = F, displayModeBar = F) %>% layout(dragmode=FALSE, plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)",
xaxis = list(showgrid = FALSE, showline=FALSE, fixedrange = TRUE), yaxis = list(showgrid = FALSE, showline=FALSE, fixedrange = TRUE)) %>%
config(locale = 'ru')
p
p <- ggplotly(p + theme(legend.position="left"), height=600, tooltip='text') %>%
config(doubleClick = F, displayModeBar = F) %>% layout(dragmode=FALSE, plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)",
xaxis = list(showgrid = FALSE, showline=FALSE, fixedrange = TRUE), yaxis = list(showgrid = FALSE, showline=FALSE, fixedrange = TRUE)) %>%
config(locale = 'ru')
p <- data_date %>% ggplot() +
geom_rect(mapping=aes(xmin=1, xmax=2, ymin=1, ymax=2, fill=value, text=""),
color=NA, alpha=1) +
facet_geo(~ code, grid = grid) +
labs(x='', y='') +
theme_minimal() +
theme(axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x=element_blank(),
axis.title.y=element_blank(),
axis.text.y=element_blank(),
axis.ticks.y=element_blank(),
strip.placement = "bottom",
plot.title = element_text(hjust = 5),
strip.background = element_blank(),
strip.text.x = element_blank(),
line = element_blank(),
plot.margin = margin(-2, "points"),
panel.spacing = unit(-2, "points")
)
if (dynam) {
p <- p + scale_fill_gradientn(name='Темпы роста, % г/г',
colours=c("#e83131", "#ffbfbf", "white", "#c3ffbf","#3AE831"),
na.value="#D0D0D0",
oob=oob_squish,
# trans="pseudo_log",
values=rescale(c(-10,-0.00000001,0,0.000000001,10)),
n.breaks=4,
minor_breaks = NULL,
limits=c(-10,10))
# p <- p + scale_fill_manual(name='Темпы роста производства, %',
#                               values=c("1" = "#FF0000", "2" = "#e83131", "3" = "#ffbfbf", "4" = "#c3ffbf", "5" = "#3AE831", "6" = "#0dff00"),
#                               na.value="#D0D0D0")
# p <- p + binned_scale("fill",
#                           "foo",
#                           ggplot2:::binned_pal(scales::manual_pal(c("#FF0000","#e83131","#ffbfbf","#c3ffbf", "#3AE831", "#0dff00"))),
#                           guide="coloursteps",
#                           breaks=c(-10,-5,0,5,10),
#                           limits=c(-10, 10),
#                           oob=oob_squish,
#                           na.value="#D0D0D0",
#                       show.limits = TRUE,
#)
} else {
p <- p + scale_fill_gradient(name=paste('Производство, ', ed, sep=''), na.value="#D0D0D0", high="#85D6FF", low = "#0078D4")
}
if (!level_fed) {
p <- p + geom_text(aes(x = 1.5, y = 1.5, label = name,
text=paste0(name_long, ', ', as.yearmon(date_choice), ': ', ifelse(is.na(value),
'нет данных',
paste0(round(value, 1), ifelse(dynam,
'%',
paste0(' ', ed))
)
)
)
), col="white", size=4)
} else {
p <- p + geom_text(aes(x = 1.5, y = 1.5, label = paste0(name_short, '\n', FD),
text=paste0(FD, ', ', as.yearmon(date_choice), ': ', ifelse(is.na(value),
'нет данных',
paste0(round(value, 1), ifelse(dynam,
'%',
paste0(' ', ed))
)
)
)
), col="white", size=4)
}
p2 <- ggplotly(p + theme(legend.position="left"), height=600, tooltip='text') %>%
config(doubleClick = F, displayModeBar = F) %>% layout(dragmode=FALSE, plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)",
xaxis = list(showgrid = FALSE, showline=FALSE, fixedrange = TRUE), yaxis = list(showgrid = FALSE, showline=FALSE, fixedrange = TRUE)) %>%
config(locale = 'ru')
p2
p
ggsave(p)
ggsave(p, '1.png')
ggsave(p, '1.png', device=NULL)
ggsave(p, '1.png')
p %>% ggsave()
ggsave('1.png', p)
ggsave(p, '1.png', scale=4)
ggsave('1.png', p, scale=4)
ggsave('1.png', p, scale=15)
ggsave('1.png', p, scale=8#)
£
ggsave('1.png', p, scale=8)
p2 <- ggplotly(p + theme(legend.position="left"), height=600, tooltip='text') %>%
config(doubleClick = F, displayModeBar = F) %>% layout(legend = list(orientation="h"), dragmode=FALSE, plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)",
xaxis = list(showgrid = FALSE, showline=FALSE, fixedrange = TRUE), yaxis = list(showgrid = FALSE, showline=FALSE, fixedrange = TRUE)) %>%
config(locale = 'ru')
p2
p2 <- ggplotly(p, height=600, tooltip='text') %>%
config(doubleClick = F, displayModeBar = F) %>% layout(legend = list(orientation="h", x = 0, y = -0.1), dragmode=FALSE, plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)",
xaxis = list(showgrid = FALSE, showline=FALSE, fixedrange = TRUE), yaxis = list(showgrid = FALSE, showline=FALSE, fixedrange = TRUE)) %>%
config(locale = 'ru')
p2
p2 <- ggplotly(p, height=600, tooltip='text') %>%
config(doubleClick = F, displayModeBar = F) %>% layout(colorbar = list(orientation="h", x = 0, y = -0.1), dragmode=FALSE, plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)",
xaxis = list(showgrid = FALSE, showline=FALSE, fixedrange = TRUE), yaxis = list(showgrid = FALSE, showline=FALSE, fixedrange = TRUE)) %>%
config(locale = 'ru')
p2
p2 <- ggplotly(p, height=600, tooltip='text') %>%
config(doubleClick = F, displayModeBar = F) %>% layout(dragmode=FALSE, plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)",
xaxis = list(showgrid = FALSE, showline=FALSE, fixedrange = TRUE), yaxis = list(showgrid = FALSE, showline=FALSE, fixedrange = TRUE)) %>%
config(locale = 'ru')
p2
runApp()
View(data)
df <- data$trade_price
View(data[["trade_price"]])
p <- df %>% mutate(NAPR = case_when(NAPR=='ЭК' ~ "Экспорт", NAPR=='ИМ' ~ 'Импорт')) %>% ggplot() +
geom_line(aes(x=date, y=mean_price, col=NAPR, text=paste0('Средняя цена',
ifelse(NAPR=="Экспорт", ' экспорта', ' импорта'),
', ',
as.yearmon(date),
': ',
round(mean_price, 2),
'$'),
group=NAPR)) +
geom_text(data=last(df %>% filter(NAPR=='Экспорт')), aes(x=date, y=mean_price), label="Экспорт", vjust=1.5) +
geom_text(data=last(df %>% filter(NAPR=='Импорт')), aes(x=date, y=mean_price), label="Импорт", vjust=1.5) +
scale_color_manual(values=c("Экспорт" = 'red', "Импорт" = 'blue'), name='Доля от внутреннего производства') +
xlab('') +
ylab('Проценты') +
theme(legend.position="none")
p <- ggplotly(p, height=700, tooltip='text') %>%
config(displayModeBar = F, locale = 'ru') %>% layout(plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)")
p
ed <- data$ed
p <- df %>% mutate(NAPR = case_when(NAPR=='ЭК' ~ "Экспорт", NAPR=='ИМ' ~ 'Импорт')) %>% ggplot() +
geom_line(aes(x=date, y=mean_price, col=NAPR, text=paste0('Средняя цена',
ifelse(NAPR=="Экспорт", ' экспорта', ' импорта'),
', ',
as.yearmon(date),
': ',
round(mean_price, 2),
'$', ed),
group=NAPR)) +
geom_text(data=last(df %>% filter(NAPR=='Экспорт')), aes(x=date, y=mean_price), label="Экспорт", vjust=1.5) +
geom_text(data=last(df %>% filter(NAPR=='Импорт')), aes(x=date, y=mean_price), label="Импорт", vjust=1.5) +
scale_color_manual(values=c("Экспорт" = 'red', "Импорт" = 'blue'), name='Доля от внутреннего производства') +
xlab('') +
ylab('Проценты') +
theme(legend.position="none")
p <- ggplotly(p, height=700, tooltip='text') %>%
config(displayModeBar = F, locale = 'ru') %>% layout(plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)")
p
data <- loadR('Сигареты и сигары', where='data_output/supply_analysis/')
data <- loadR('Сигареты и папиросы', where='data_output/supply_analysis/')
df <- data$trade_price
ed <- data$ed
ed
p <- df %>% mutate(NAPR = case_when(NAPR=='ЭК' ~ "Экспорт", NAPR=='ИМ' ~ 'Импорт')) %>% ggplot() +
geom_line(aes(x=date, y=mean_price, col=NAPR, text=paste0('Средняя цена',
ifelse(NAPR=="Экспорт", ' экспорта', ' импорта'),
', ',
as.yearmon(date),
': ',
round(mean_price, 2),
'$/', ed),
group=NAPR)) +
geom_text(data=last(df %>% filter(NAPR=='Экспорт')), aes(x=date, y=mean_price), label="Экспорт", vjust=1.5) +
geom_text(data=last(df %>% filter(NAPR=='Импорт')), aes(x=date, y=mean_price), label="Импорт", vjust=1.5) +
scale_color_manual(values=c("Экспорт" = 'red', "Импорт" = 'blue'), name='Доля от внутреннего производства') +
xlab('') +
ylab('Проценты') +
theme(legend.position="none")
p <- ggplotly(p, height=700, tooltip='text') %>%
config(displayModeBar = F, locale = 'ru') %>% layout(plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)")
p
data <- loadR('Сигареты и папиросы', where='data_output/supply_analysis/')
View(data)
View(data[["trade_price"]])
df <- data$trade_price
ed <- df$EDIZM[1]
ed
tolower(ed)
ed <- tolower(df$EDIZM[1])
p <- df %>% mutate(NAPR = case_when(NAPR=='ЭК' ~ "Экспорт", NAPR=='ИМ' ~ 'Импорт')) %>% ggplot() +
geom_line(aes(x=date, y=mean_price, col=NAPR, text=paste0('Средняя цена',
ifelse(NAPR=="Экспорт", ' экспорта', ' импорта'),
', ',
as.yearmon(date),
': ',
round(mean_price, 2),
'$/', ed),
group=NAPR)) +
geom_text(data=last(df %>% filter(NAPR=='Экспорт')), aes(x=date, y=mean_price), label="Экспорт", vjust=1.5) +
geom_text(data=last(df %>% filter(NAPR=='Импорт')), aes(x=date, y=mean_price), label="Импорт", vjust=1.5) +
scale_color_manual(values=c("Экспорт" = 'red', "Импорт" = 'blue'), name='Доля от внутреннего производства') +
xlab('') +
ylab('$/') +
theme(legend.position="none")
p <- ggplotly(p, height=700, tooltip='text') %>%
config(displayModeBar = F, locale = 'ru') %>% layout(plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)")
p <- df %>% mutate(NAPR = case_when(NAPR=='ЭК' ~ "Экспорт", NAPR=='ИМ' ~ 'Импорт')) %>% ggplot() +
geom_line(aes(x=date, y=mean_price, col=NAPR, text=paste0('Средняя цена',
ifelse(NAPR=="Экспорт", ' экспорта', ' импорта'),
', ',
as.yearmon(date),
': ',
round(mean_price, 2),
'$/', ed),
group=NAPR)) +
geom_text(data=last(df %>% filter(NAPR=='Экспорт')), aes(x=date, y=mean_price), label="Экспорт", vjust=1.5) +
geom_text(data=last(df %>% filter(NAPR=='Импорт')), aes(x=date, y=mean_price), label="Импорт", vjust=1.5) +
scale_color_manual(values=c("Экспорт" = 'red', "Импорт" = 'blue'), name='Доля от внутреннего производства') +
xlab('') +
ylab(paste0('$/', ed)) +
theme(legend.position="none")
p <- ggplotly(p, height=700, tooltip='text') %>%
config(displayModeBar = F, locale = 'ru') %>% layout(plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)")
p
runApp()
convert=TRUE
df <- data$trade_price
ed <- tolower(df$EDIZM[1])
runApp()
runApp()
data <- loadR('Сигареты и папиросы', where='data_output/supply_analysis/')
View(data)
View(data[["trade_price"]])
runApp()
runApp()
data <- loadR('Сигареты и папиросы', where='data_output/supply_analysis/')
View(data)
df <- data$prod_price
df <- data$prod_price
View(df)
# ed <- tolower(df$EDIZM[1])
p <- df %>% ggplot() + geom_line(aes(x=date, y=value, text=paste0('Средние цены производителей',
', ',
as.yearmon(date),
': ',
round(mean_price, 2),
'руб./'),
group=NAPR)) +
geom_text(data=last(df %>% filter(NAPR=='Экспорт')), aes(x=date, y=mean_price), label="Экспорт", vjust=1.5) +
geom_text(data=last(df %>% filter(NAPR=='Импорт')), aes(x=date, y=mean_price), label="Импорт", vjust=1.5) +
scale_color_manual(values=c("Экспорт" = 'red', "Импорт" = 'blue'), name='Доля от внутреннего производства') +
xlab('') +
ylab('руб./') +
theme(legend.position="none")
# ed <- tolower(df$EDIZM[1])
p <- df %>% ggplot() + geom_line(aes(x=date, y=value, text=paste0('Средние цены производителей',
', ',
as.yearmon(date),
': ',
round(mean_price, 2),
'руб./'),
group=1)) +
xlab('') +
ylab('руб./') +
theme(legend.position="none")
p <- ggplotly(p, tooltip='text') %>%
config(displayModeBar = F, locale = 'ru') %>% layout(plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)")
p
# ed <- tolower(df$EDIZM[1])
p <- df %>% ggplot() + geom_line(aes(x=date, y=value, text=paste0('Средние цены производителей',
', ',
as.yearmon(date),
': ',
round(value, 2),
'руб./'),
group=1)) +
xlab('') +
ylab('руб./') +
theme(legend.position="none")
p <- ggplotly(p, tooltip='text') %>%
config(displayModeBar = F, locale = 'ru') %>% layout(plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)")
p
data$prod_price_names
data <- loadR('Сигареты и папиросы', where='data_output/supply_analysis/')
df <- data$prod_price
data$prod_price_names
# ed <- tolower(df$EDIZM[1])
p <- df %>% ggplot() + geom_line(aes(x=date, y=value, text=paste0('Средние цены производителей',
', ',
as.yearmon(date),
': ',
round(value, 2),
'руб.'),
group=1)) +
xlab('') +
ylab('руб./') +
scale_color_discrete(name=unique(data$prod_price_names))
p <- ggplotly(p, tooltip='text') %>%
config(displayModeBar = F, locale = 'ru') %>% layout(plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)")
p
unique(data$prod_price_names)
# ed <- tolower(df$EDIZM[1])
p <- df %>% ggplot() + geom_line(aes(x=date, y=value, col='blue', text=paste0('Средние цены производителей',
', ',
as.yearmon(date),
': ',
round(value, 2),
'руб.'),
group=1)) +
xlab('') +
ylab('руб./') +
scale_color_discrete(name=unique(data$prod_price_names))
p <- ggplotly(p, tooltip='text') %>%
config(displayModeBar = F, locale = 'ru') %>% layout(plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)")
p
# ed <- tolower(df$EDIZM[1])
p <- df %>% ggplot() + geom_line(aes(x=date, y=value, col='blue', text=paste0('Средние цены производителей',
', ',
as.yearmon(date),
': ',
round(value, 2),
'руб.'),
group=1)) +
xlab('') +
ylab('руб./') +
scale_color_discrete(name=unique(data$prod_price_names)) +
theme(legend.position='bottom')
p <- ggplotly(p, tooltip='text') %>%
config(displayModeBar = F, locale = 'ru') %>% layout(plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)")
p
p <- ggplotly(p, tooltip='text') %>%
config(displayModeBar = F, locale = 'ru') %>% layout(legend = list(orientation='h', x=0, y=-0.3), plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)")
p
# ed <- tolower(df$EDIZM[1])
p <- df %>% ggplot() + geom_line(aes(x=date, y=value, col='blue', text=paste0('Средние цены производителей',
', ',
as.yearmon(date),
': ',
round(value, 2),
'руб.'),
group=1)) +
xlab('') +
ylab('руб./') +
scale_color_discrete(name=unique(data$prod_price_names)) +
theme(legend.position='bottom')
p <- ggplotly(p, tooltip='text') %>%
config(displayModeBar = F, locale = 'ru') %>% layout(legend = list(orientation='h', x=0, y=-0.3), plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)")
p
p <- ggplotly(p, tooltip='text') %>%
config(displayModeBar = F, locale = 'ru') %>% layout(legend = list(orientation='h', x=0, y=0), plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)")
p
p <- ggplotly(p, tooltip='text') %>%
config(displayModeBar = F, locale = 'ru') %>% layout(legend = list(orientation='h', x=0, y=-0.1), plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)")
p
# ed <- tolower(df$EDIZM[1])
p <- df %>% ggplot() + geom_line(aes(x=date, y=value, col='blue', text=paste0('Средние цены производителей',
', ',
as.yearmon(date),
': ',
round(value, 2),
'руб.'),
group=1)) +
xlab('') +
ylab('руб./') +
annotate(unique(data$prod_price_names), x=0, y=-0.1) +
theme(legend.position='none')
# ed <- tolower(df$EDIZM[1])
p <- df %>% ggplot() + geom_line(aes(x=date, y=value, col='blue', text=paste0('Средние цены производителей',
', ',
as.yearmon(date),
': ',
round(value, 2),
'руб.'),
group=1)) +
xlab('') +
ylab('руб./') +
annotate("text", label = unique(data$prod_price_names), x=0, y=-0.1) +
theme(legend.position='none')
p <- ggplotly(p, tooltip='text') %>%
config(displayModeBar = F, locale = 'ru') %>% layout(legend = list(orientation='h', x=0, y=-0.1), plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)")
df <- data$prod_price
# ed <- tolower(df$EDIZM[1])
p <- df %>% ggplot() + geom_line(aes(x=date, y=value, col='blue', text=paste0('Средние цены производителей',
', ',
as.yearmon(date),
': ',
round(value, 2),
'руб.'),
group=1)) +
xlab('') +
ylab('руб./') +
annotate("text", label = unique(data$prod_price_names), x=0, y=-0.1) +
theme(legend.position='none')
p <- ggplotly(p, tooltip='text') %>%
config(displayModeBar = F, locale = 'ru') %>% layout(plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)")
# ed <- tolower(df$EDIZM[1])
p <- df %>% ggplot() + geom_line(aes(x=date, y=value, col='blue', text=paste0('Средние цены производителей',
', ',
as.yearmon(date),
': ',
round(value, 2),
'руб.'),
group=1)) +
xlab('') +
ylab('руб./') +
annotate("text", label = unique(data$prod_price_names), x=as.Date('2018-01-01'), y=-0.1) +
theme(legend.position='none')
p <- ggplotly(p, tooltip='text') %>%
config(displayModeBar = F, locale = 'ru') %>% layout(plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)")
p
# ed <- tolower(df$EDIZM[1])
p <- df %>% ggplot() + geom_line(aes(x=date, y=value, col='blue', text=paste0('Средние цены производителей',
', ',
as.yearmon(date),
': ',
round(value, 2),
'руб.'),
group=1)) +
xlab('') +
ylab('руб./') +
annotate("text", label = unique(data$prod_price_names), x=as.Date('2018-01-01'), y=-0.5) +
theme(legend.position='none')
p <- ggplotly(p, tooltip='text') %>%
config(displayModeBar = F, locale = 'ru') %>% layout(plot_bgcolor  = "rgba(0, 0, 0, 0)", paper_bgcolor = "rgba(0, 0, 0, 0)")
p
runApp()
runApp()
runApp()
runApp()
